# AR_kalman_connectivity<br>
This is a sample of python implementation for time-varying effective connectivity analysis, based on Autoregressive (AR) model with Kalman filter. <br>

# Folder structures<br>
\ChangeDetectSim<br>
&ensp;&ensp;├── \figures … contains the figures generated by the script (main.py)<br>
&ensp;&ensp;│<br>
&ensp;&ensp;├─ \my_modules<br>
&ensp;&ensp;│&ensp;&ensp;&ensp;├─ ar_kalman_connectivity.py … contains main modules of time-variant AR model with Kalman filter inference<br>
&ensp;&ensp;│&ensp;&ensp;&ensp;└─ myfunc.py … contains some user-defined modules results<br>
&ensp;&ensp;│<br>
&ensp;&ensp;├── \save_data … contains the dataset of estimation results <br>
&ensp;&ensp;│<br>
&ensp;&ensp;└─ main.py <br>
&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;… contains sample examples for how to use of the module “ar_kalman_connectivity.py”  <br>


# Requirements<br>
&ensp; Operation has been confirmed only under the following environment. <br>
&ensp;&ensp; - Python 3.8.3 <br>
&ensp;&ensp; - conda 4.8.4  <br>
&ensp;&ensp; - Spyder 4.1.4 <br>
&ensp;&ensp; - numpy 1.18.5 <br>
&ensp;&ensp; - scipy 1.5.0 <br>
&ensp;&ensp; - matplotlib 3.2.2<br>
&ensp;&ensp; - networkx 2.4 <br>
&ensp;&ensp; - IPython 7.16.1 <br>
&ensp;&ensp; - joblib 0.16.0 <br>
&ensp; <br>
&ensp; The sample scripts are not guaranteed to run on any other version in Python than the above.<br>
&ensp; <br>
# Authors<br>
&ensp; Hiroshi Yokoyama<br>
&ensp;&ensp;(Division of Neural Dynamics, Department of System Neuroscience, National Institute for Physiological Sciences, Japan)<br>

# Example of use<br>
```python
# Define the module
from my_modules.ar_kalman_connectivity import AR_Kalman

# Initialize
model = AR_Kalman(x, p, uc, flimits)
# Fit the model and Estmate the time-variant connectivity
model.est_kalman()

# Get the estimation results
y_hat   = model.y_hat   # mean of posterior predictive distribution for the observation model, with size of [samples x channels]
S       = model.S       # covariance of posterior predictive distribution for the observation model, with size of [channels x channels x samples]
loglike = model.loglike # marginal log-likelihood function, with size of [samples x 1]
PDC     = model.PDC     # time-variant partial directed coherence (PDC), with size of [channels x channels x samples]
```
